<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Inventory AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* CSS ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á) */
        :root {
            --primary: #00f2ff; /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏ô‡∏µ‡∏≠‡∏≠‡∏ô */
            --secondary: #7000ff; /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á */
            --bg-dark: #050510;
            --bg-panel: rgba(20, 20, 35, 0.8);
            --success: #00ff9d;
            --error: #ff3333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 242, 255, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(112, 0, 255, 0.1) 0%, transparent 40%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .dashboard {
            width: 100%;
            max-width: 900px;
            background: var(--bg-panel);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
        }

        h1 {
            font-family: 'Chakra Petch', sans-serif;
            font-weight: 700;
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #fff, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .subtitle {
            text-align: center;
            color: #8892b0;
            margin-bottom: 40px;
            font-size: 0.9rem;
        }

        /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î --- */
        .upload-zone {
            border: 2px dashed rgba(0, 242, 255, 0.3);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            background: rgba(0, 242, 255, 0.02);
            position: relative;
            overflow: hidden;
        }

        .upload-zone:hover {
            border-color: var(--primary);
            background: rgba(0, 242, 255, 0.05);
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.1);
        }

        .icon-folder { font-size: 48px; margin-bottom: 15px; display: block; filter: drop-shadow(0 0 10px var(--primary)); }
        .upload-text { font-size: 1.1rem; color: #ccd6f6; }
        .upload-hint { font-size: 0.8rem; color: #8892b0; margin-top: 5px; }

        /* --- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• --- */
        #displayArea {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .image-container {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            line-height: 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        img { width: 100%; display: block; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* --- Animation ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î --- */
        .scan-line {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 5px;
            background: var(--primary);
            box-shadow: 0 0 20px var(--primary);
            animation: scan 1.5s linear infinite;
            display: none;
            z-index: 10;
        }
        .loading .scan-line { display: block; }

        @keyframes scan {
            0% { top: 0; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        /* --- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç --- */
        .result-box {
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }
        
        .count-number {
            font-family: 'Chakra Petch', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            color: var(--success);
            text-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
        }

        /* --- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --- */
        .status-text {
            text-align: center;
            margin-top: 20px;
            font-weight: 600;
            min-height: 24px;
        }
        .text-process { color: var(--primary); animation: pulse 1s infinite; }
        .text-error { color: var(--error); }
        .text-success { color: var(--success); }

        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ */
        input[type="file"] { display: none; }
    </style>
</head>
<body>

    <div class="dashboard">
        <h1>AI Inventory Vision</h1>
        <p class="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡∏î‡πâ‡∏ß‡∏¢ YOLOv8</p>

        <div class="upload-zone" id="dropZone">
            <span class="icon-folder">üìÅ</span>
            <div class="upload-text">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
            <div class="upload-hint">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG</div>
        </div>
        <input type="file" id="fileInput" accept="image/*">

        <div class="status-text" id="statusText"></div>

        <div id="displayArea">
            <div class="image-container" id="imgWrapper">
                <img id="previewImg" src="">
                <canvas id="overlayCanvas"></canvas>
                <div class="scan-line"></div>
            </div>

            <div class="result-box" id="resultBox">
                <div style="font-size: 0.9rem; color: #aaa;">‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                <div class="count-number" id="countNum">0</div>
                <div style="font-size: 0.9rem; color: #aaa;">‡∏ä‡∏¥‡πâ‡∏ô</div>
            </div>
        </div>
    </div>

    <script>
        // =================================================================
        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URL API
        // SERVER_ROOT_URL ‡∏Ñ‡∏∑‡∏≠ URL ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Render (‡πÄ‡∏ä‡πà‡∏ô https://yolo-backend-api.onrender.com)
        // =================================================================
        const SERVER_ROOT_URL = "https://yolo-backend-api.onrender.com"; 
        const DETECT_ENDPOINT = SERVER_ROOT_URL + "/detect";

        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const displayArea = document.getElementById('displayArea');
        const imgWrapper = document.getElementById('imgWrapper');
        const img = document.getElementById('previewImg');
        const canvas = document.getElementById('overlayCanvas');
        const ctx = canvas.getContext('2d');
        const statusText = document.getElementById('statusText');
        const resultBox = document.getElementById('resultBox');
        const countNum = document.getElementById('countNum');

        // --- Event Listeners (Drag & Drop) ---
        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => { 
            e.preventDefault(); 
            dropZone.style.borderColor = '#00f2ff'; 
            dropZone.style.background = 'rgba(0, 242, 255, 0.1)';
        });

        dropZone.addEventListener('dragleave', (e) => { 
            dropZone.style.borderColor = 'rgba(0, 242, 255, 0.3)'; 
            dropZone.style.background = 'rgba(0, 242, 255, 0.02)';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'rgba(0, 242, 255, 0.3)';
            dropZone.style.background = 'rgba(0, 242, 255, 0.02)';
            if(e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });

        fileInput.addEventListener('change', (e) => {
            if(e.target.files.length) handleFile(e.target.files[0]);
        });

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå ---
        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showStatus("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", "error");
                return;
            }

            // Reset ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            resultBox.style.display = 'none';
            displayArea.style.display = 'block';
            showStatus("", "");
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏õ
            const url = URL.createObjectURL(file);
            img.src = url;
            
            img.onload = () => {
                canvas.width = img.clientWidth;
                canvas.height = img.clientHeight;
                
                // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                uploadAndDetect(file);
            };
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏´‡∏≤ AI ---
        async function uploadAndDetect(file) {
            imgWrapper.classList.add('loading'); // ‡πÄ‡∏£‡∏¥‡πà‡∏° Animation ‡∏™‡πÅ‡∏Å‡∏ô
            
            // Step 1: ‡∏õ‡∏•‡∏∏‡∏Å Server (Ping)
            // ‡∏¢‡∏¥‡∏á GET ‡πÑ‡∏õ‡∏ó‡∏µ‡πà URL ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Server (/) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ 405/Cold Start
            showStatus("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏™‡∏°‡∏≠‡∏á AI (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ñ‡πâ‡∏≤ Server ‡∏´‡∏•‡∏±‡∏ö‡∏≠‡∏¢‡∏π‡πà)...", "process");
            
            try {
                // GET request ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Ping/Wake-Up (‡πÉ‡∏ä‡πâ Root URL)
                const wakeUp = await fetch(SERVER_ROOT_URL, { method: 'GET' });
                
                if(!wakeUp.ok) throw new Error(`Server ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á (HTTP ${wakeUp.status})`);

                // Step 2: ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (POST request ‡πÑ‡∏õ‡∏ó‡∏µ‡πà /detect)
                showStatus("üöÄ Server ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...", "process");

                const formData = new FormData();
                formData.append("file", file);

                const response = await fetch(DETECT_ENDPOINT, { // ‡πÉ‡∏ä‡πâ DETECT_ENDPOINT
                    method: "POST",
                    body: formData
                });

                if (!response.ok) {
                    const errData = await response.text();
                    throw new Error(`API Error: ${response.status} - ${errData}`);
                }

                const data = await response.json();

                // Step 3: ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                imgWrapper.classList.remove('loading');
                showStatus("‚úÖ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô", "success");
                
                // ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö
                drawBoxes(data.detections);
                
                // ‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
                countNum.innerText = data.count; // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ count ‡∏à‡∏≤‡∏Å Backend
                resultBox.style.display = 'block';

            } catch (error) {
                console.error(error);
                imgWrapper.classList.remove('loading');
                
                let msg = error.message;
                if(msg.includes("Failed to fetch")) {
                    msg = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏î‡πâ (‡πÄ‡∏ô‡πá‡∏ï‡∏´‡∏•‡∏∏‡∏î, CORS, ‡∏´‡∏£‡∏∑‡∏≠ Server ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏∑‡πà‡∏ô)";
                } else if (msg.includes("405")) {
                    msg = "‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò (405 Method Not Allowed) - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL";
                }
                showStatus(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${msg}`, "error");
            }
        }

        function drawBoxes(detections) {
            const scaleX = canvas.width / img.naturalWidth;
            const scaleY = canvas.height / img.naturalHeight;

            ctx.clearRect(0, 0, canvas.width, canvas.height); 
            
            detections.forEach(det => {
                const [x1, y1, x2, y2] = det.box;
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î
                const rectX = x1 * scaleX;
                const rectY = y1 * scaleY;
                const rectW = (x2 - x1) * scaleX;
                const rectH = (y2 - y1) * scaleY;

                // ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡πÑ‡∏ï‡∏•‡πå Sci-Fi
                ctx.strokeStyle = "#00ff9d";
                ctx.lineWidth = 2;
                ctx.shadowColor = "#00ff9d";
                ctx.shadowBlur = 10;
                ctx.strokeRect(rectX, rectY, rectW, rectH);
                ctx.shadowBlur = 0;

                // ‡∏õ‡πâ‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
                ctx.fillStyle = "rgba(0, 255, 157, 0.8)";
                const text = `${det.label} ${Math.round(det.confidence * 100)}%`;
                ctx.font = "600 12px Inter";
                const textWidth = ctx.measureText(text).width;
                const textPadding = 5;
                const textHeight = 20;
                
                // ‡∏ß‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
                ctx.fillRect(rectX, rectY - textHeight, textWidth + (textPadding * 2), textHeight);

                // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                ctx.fillStyle = "#000";
                ctx.fillText(text, rectX + textPadding, rectY - 6);
            });
        }

        function showStatus(text, type) {
            statusText.innerText = text;
            statusText.className = "status-text"; 
            if (type === "process") statusText.classList.add("text-process");
            if (type === "error") statusText.classList.add("text-error");
            if (type === "success") statusText.classList.add("text-success");
        }
    </script>
</body>
</html>
